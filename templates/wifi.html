{% extends "base.html" %}
{% block content %}
<h1>Wi-Fi Networks</h1>

<div class="card">
  {% if state and state.connected %}
    <p class="muted">
      Connected to <strong>{{ state.ssid }}</strong>
      {% if state.ip %} â€¢ IP <code>{{ state.ip }}</code>{% endif %}
    </p>
  {% else %}
    <p class="muted">Not connected to Wi-Fi.</p>
  {% endif %}

  <form method="get" action="{{ url_for('wifi_scan') }}">
    <button class="btn" type="submit">Scan</button>
  </form>

  {% if aps and aps|length > 0 %}
    <table class="table">
      <thead><tr><th>SSID</th><th>Join</th></tr></thead>
      <tbody>
        {% for ap in aps %}
          <tr>
            <td>
              {{ ap.ssid }}
              {% if state.connected and ap.ssid == state.ssid %}
                <span class="badge ok">Connected</span>
              {% endif %}
            </td>
            <td>
              {% if state.connected and ap.ssid == state.ssid %}
                <button class="btn" type="button" disabled>Joined</button>
              {% else %}
                <form method="post" action="{{ url_for('wifi_apply') }}" class="inline">
                  <input type="hidden" name="ssid" value="{{ ap.ssid }}">
                  <input name="psk" type="password" placeholder="Password" required>
                  <button class="btn" type="submit">Join</button>
                </form>
              {% endif %}
            </td>
          </tr>
        {% endfor %}
      </tbody>
    </table>
  {% else %}
    <p class="muted">No networks found yet. Try scanning again.</p>
  {% endif %}
</div>
{% endblock %}
